<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sample Quotation</title>
    <meta name="description" content="Company quotation">
    <meta name="author" content="SitePoint">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap 3 CSS for Glyphicons support -->
    <link rel="stylesheet"
          href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
          xintegrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu"
          crossorigin="anonymous">
    <style>
    body {
        font-family: "Inter", sans-serif;
    }
    .container {
        max-width: 960px;
        margin: 0 auto;
        padding: 15px;
    }
    .btn-delete:hover {
        opacity: 0.8;
    }
    /* Custom Modal styles */
    .custom-modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 1050; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }
    .custom-modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 80%; /* Could be more or less, depending on screen size */
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .custom-modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #eee;
        padding-bottom: 10px;
        margin-bottom: 15px;
    }
    .custom-modal-footer {
        display: flex;
        justify-content: flex-end;
        border-top: 1px solid #eee;
        padding-top: 10px;
        margin-top: 15px;
    }
    .custom-modal-close {
        color: #aaa;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
    }
    .custom-modal-close:hover,
    .custom-modal-close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    </style>
</head>
<body>
    <div class="container">
        <h2>VMS HACKER</h2>
        <p>
            Bangsaothong<br>
            Samutrprakarn<br>
            THAILAND<br>
            30000<br>
            <span class="glyphicon glyphicon-earphone" aria-hidden="true"></span> : 12345678<br>
            <span class="glyphicon glyphicon-phone" aria-hidden="true"></span> : 12345678
        </p>
        <div class="text-center">
            <h1>QUOTATION</h1>
            <img src="https://admissions.au.edu/wp-content/uploads/2019/08/science.jpg" alt="Logo" style="width:100px;height:100px; border-radius: 8px;">
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-sm-4">
                <h3>Customer:</h3>
                <div id="customerInfo">
                    <strong id="customerNameDisplay">Sample customer name 001</strong><br>
                    <span id="customerAddressDisplay">
                        Sample address line1<br>
                        Sample address line2<br>
                        Sample address line3
                    </span>
                </div>
                <button type="button" class="btn btn-xs btn-default" data-toggle="modal" data-target="#customerModal" style="margin-top: 5px;">Edit Customer</button>
            </div>
            <div class="col-sm-4">
                <h3>Ship to:</h3>
                <div id="shipToInfo">
                    <strong id="shipToNameDisplay">Sample customer name 001</strong><br>
                    <span id="shipToAddressDisplay">
                        Sample address line1<br>
                        Sample address line2<br>
                        Sample address line3
                    </span>
                </div>
                <button type="button" class="btn btn-xs btn-default" data-toggle="modal" data-target="#shipToModal" style="margin-top: 5px;">Edit Ship To</button>
            </div>
            <div class="col-sm-4 text-right">
                <h4 id="quotationDate"></h4>
            </div>
        </div>
    </div>

    <div class="container" style="margin-top:20px;">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
            Add Item
        </button>
        <table class="table table-striped table-bordered table-condensed" id="quotationTable" style="margin-top:15px;">
            <thead>
                <tr>
                    <th>Quantity</th>
                    <th>Description</th>
                    <th>Unit Price</th>
                    <th>Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
            <tfoot>
                <tr id="sub-total">
                    <td colspan="3" class="text-right">Subtotal</td>
                    <td class="text-right" id="subTotal">0.00</td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="3" class="text-right">VAT (7%)</td>
                    <td class="text-right" id="vat">0.00</td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="3" class="text-right">Shipping &amp; Handling</td>
                    <td class="text-right" id="bottom-line">0.00</td>
                    <td></td>
                </tr>
                <tr>
                    <td colspan="3" class="text-right">Total Due</td>
                    <td class="text-right" id="total">0.00</td>
                    <td></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <!-- Add Item Modal Form -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
         aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="exampleModalLabel">Add Item</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="itemForm">
              <div class="form-group">
                <label for="newItemDescription">Description</label>
                <input type="text" class="form-control" id="newItemDescription" placeholder="Enter description">
              </div>
              <div class="form-group">
                <label for="newItemPPU">Price Per Unit</label>
                <input type="number" min="0" step="0.01" class="form-control" id="newItemPPU">
              </div>
              <div class="form-group">
                <label for="newItemQty">Quantity</label>
                <input type="number" min="0" class="form-control" id="newItemQty">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="addItem()">Save Item</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Customer Details Modal Form -->
    <div class="modal fade" id="customerModal" tabindex="-1" role="dialog"
         aria-labelledby="customerModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="customerModalLabel">Edit Customer Details</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="customerForm">
              <div class="form-group">
                <label for="customerNameInput">Customer Name</label>
                <input type="text" class="form-control" id="customerNameInput" placeholder="Enter customer name">
              </div>
              <div class="form-group">
                <label for="customerAddressInput">Address</label>
                <textarea class="form-control" id="customerAddressInput" rows="3" placeholder="Enter customer address"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="saveCustomerDetails()">Save Changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Ship To Details Modal Form -->
    <div class="modal fade" id="shipToModal" tabindex="-1" role="dialog"
         aria-labelledby="shipToModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="shipToModalLabel">Edit Ship To Details</h4>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form id="shipToForm">
              <div class="form-group">
                <label for="shipToNameInput">Ship To Name</label>
                <input type="text" class="form-control" id="shipToNameInput" placeholder="Enter ship to name">
              </div>
              <div class="form-group">
                <label for="shipToAddressInput">Address</label>
                <textarea class="form-control" id="shipToAddressInput" rows="3" placeholder="Enter ship to address"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary" onclick="saveShipToDetails()">Save Changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Custom Alert/Confirmation Modal -->
    <div id="customAlertModal" class="custom-modal">
      <div class="custom-modal-content">
        <div class="custom-modal-header">
          <h4 id="customAlertTitle">Alert</h4>
          <span class="custom-modal-close">&times;</span>
        </div>
        <div class="custom-modal-body" id="customAlertMessage">
          <!-- Message will be inserted here -->
        </div>
        <div class="custom-modal-footer" id="customAlertFooter">
          <!-- Buttons will be inserted here -->
        </div>
      </div>
    </div>


    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
            crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"
            xintegrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd"
            crossorigin="anonymous"></script>

    <script>
    var quoationData = [];
    var quotationInfo = {
        customer: {
            name: "Sample customer name 001",
            address: "Sample address line1\nSample address line2\nSample address line3"
        },
        shipTo: {
            name: "Sample customer name 001",
            address: "Sample address line1\nSample address line2\nSample address line3"
        }
    };

    // Custom Modal functions
    function showCustomModal(title, message, isConfirm, callback) {
        $("#customAlertTitle").text(title);
        $("#customAlertMessage").text(message);
        $("#customAlertFooter").empty(); // Clear existing buttons

        if (isConfirm) {
            $("#customAlertFooter").append(`
                <button type="button" class="btn btn-default" id="customModalCancel">Cancel</button>
                <button type="button" class="btn btn-danger" id="customModalConfirm">Confirm</button>
            `);
            $("#customModalConfirm").on("click", function() {
                $("#customAlertModal").hide();
                if (callback) callback(true);
            });
            $("#customModalCancel").on("click", function() {
                $("#customAlertModal").hide();
                if (callback) callback(false);
            });
        } else {
            $("#customAlertFooter").append(`
                <button type="button" class="btn btn-primary" id="customModalOk">OK</button>
            `);
            $("#customModalOk").on("click", function() {
                $("#customAlertModal").hide();
                if (callback) callback();
            });
        }
        $("#customAlertModal").show();

        $(".custom-modal-close").on("click", function() {
            $("#customAlertModal").hide();
            if (isConfirm && callback) callback(false); // If it's a confirm, closing means cancel
        });

        // Close modal if user clicks outside of it
        $(window).on("click", function(event) {
            if ($(event.target).is("#customAlertModal")) {
                $("#customAlertModal").hide();
                if (isConfirm && callback) callback(false);
            }
        });
    }

    // Function to load data from localStorage
    function loadData() {
        var storedQuotationData = localStorage.getItem('quoationData');
        if (storedQuotationData) {
            quoationData = JSON.parse(storedQuotationData);
        }
        var storedQuotationInfo = localStorage.getItem('quotationInfo');
        if (storedQuotationInfo) {
            quotationInfo = JSON.parse(storedQuotationInfo);
        }
    }

    // Function to save data to localStorage
    function saveData() {
        localStorage.setItem('quoationData', JSON.stringify(quoationData));
        localStorage.setItem('quotationInfo', JSON.stringify(quotationInfo));
    }

    function addItem() {
        var desc = $("#newItemDescription").val();
        var price = parseFloat($("#newItemPPU").val()) || 0;
        var qty = parseInt($("#newItemQty").val()) || 0;

        if (!desc || price <= 0 || qty <= 0) {
            showCustomModal("Error", "Please enter a description and valid price/quantity.", false);
            return;
        }
        quoationData.push({ description: desc, quantity: qty, unitPrice: price });
        $("#itemForm")[0].reset();
        $("#exampleModal").modal("hide");
        saveData(); // Save data after adding item
        renderTable();
    }

    function renderTable() {
        var data = quoationData;
        var subTotal = 0;
        $("#quotationTable tbody").empty();

        data.forEach(function(e, i) {
            var amount = e.unitPrice * e.quantity;
            subTotal += amount;

            var row = `<tr class="data-row">
                <td class="text-center">${e.quantity}</td>
                <td>${e.description}</td>
                <td class="text-right">${e.unitPrice.toFixed(2)}</td>
                <td class="text-right">${amount.toFixed(2)}</td>
                <td class="text-center">
                  <button class="btn btn-sm btn-danger btn-delete"
                          onclick="handleDeleteItem(${i})">
                    Delete
                  </button>
                </td>
            </tr>`;
            $("#quotationTable tbody").append(row);
        });

        var vat = subTotal * 0.07;
        var total = subTotal + vat;

        $("#subTotal").text(subTotal.toFixed(2));
        $("#vat").text(vat.toFixed(2));
        $("#total").text(total.toFixed(2));

        // Update Customer and Ship To display
        $("#customerNameDisplay").text(quotationInfo.customer.name);
        $("#customerAddressDisplay").html(quotationInfo.customer.address.replace(/\n/g, '<br>'));
        $("#shipToNameDisplay").text(quotationInfo.shipTo.name);
        $("#shipToAddressDisplay").html(quotationInfo.shipTo.address.replace(/\n/g, '<br>'));
    }

    function handleDeleteItem(index) {
        showCustomModal("Confirmation", "Are you sure you want to delete this item?", true, function(result) {
            if (result) {
                deleteItem(index);
            }
        });
    }

    function deleteItem(i) {
        quoationData.splice(i, 1);
        saveData(); // Save data after deleting item
        renderTable();
    }

    // Customer Modal functions
    function saveCustomerDetails() {
        quotationInfo.customer.name = $("#customerNameInput").val();
        quotationInfo.customer.address = $("#customerAddressInput").val();
        saveData();
        renderTable();
        $("#customerModal").modal("hide");
    }

    // Ship To Modal functions
    function saveShipToDetails() {
        quotationInfo.shipTo.name = $("#shipToNameInput").val();
        quotationInfo.shipTo.address = $("#shipToAddressInput").val();
        saveData();
        renderTable();
        $("#shipToModal").modal("hide");
    }

    $(document).ready(function() {
        loadData(); // Load data on page load
        // Initialize date
        var today = new Date();
        $("#quotationDate").text(today.toDateString());
        renderTable();

        // Populate customer modal when opened
        $('#customerModal').on('show.bs.modal', function () {
            $("#customerNameInput").val(quotationInfo.customer.name);
            $("#customerAddressInput").val(quotationInfo.customer.address);
        });

        // Populate ship to modal when opened
        $('#shipToModal').on('show.bs.modal', function () {
            $("#shipToNameInput").val(quotationInfo.shipTo.name);
            $("#shipToAddressInput").val(quotationInfo.shipTo.address);
        });
    });
    </script>
</body>
</html>
